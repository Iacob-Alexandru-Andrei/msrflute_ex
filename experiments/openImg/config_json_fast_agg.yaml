# New setup section to avoid having to rewrite the entire it entirely
setup:
    outputPath: "/nfs-share/aai30/projects/msrflute_ex/outputs/openImg/files"
    dataPath: "/datasets/FedScale/openImg"
    task: "openImg"
    backend: "nccl"
    num_skip_decoding: Null
    local_rank: Null

# Basic configuration file for running classif_cnn example using torchvision CIFAR10 dataset.
# Parameters needed to initialize the model
model_config:
    model_type: SHUFFLENET # class w/ `loss` and `inference` methods
    model_folder: experiments/openImg/model.py # file containing class

# Configuration for differential privacy
dp_config:
    enable_local_dp: false # whether to enable user-level DP

# Additional privacy metrics
privacy_metrics_config:
    apply_metrics: false # cache data to compute additional metrics

# Select the Federated optimizer to use (e.g. DGA or FedAvg)
strategy: FedAvg

# Determines all the server-side settings for training and evaluation rounds
server_config:
    wantRL: false # whether to use RL-based meta-optimizers
    resume_from_checkpoint: false # restart from checkpoint if file exists
    do_profiling: false # run profiler and compute runtime metrics
    optimizer_config: # this is the optimizer used to update the model
        type: sgd
        lr: 1.0
    annealing_config: # annealer for the learning rate
        type: none
        step_interval: epoch
        gamma: 1.0
        step_size: 5000000
    val_freq: 5000000 # how many iterations between metric eval on val set
    rec_freq: 5000000 # how many iterations between metric eval on test set
    initial_val: false
    initial_rec: false
    max_iteration: 100
    model_backup_freq: 1 # how many iterations in total
    num_clients_per_iteration: 100 # how many clients per iteration
    data_config: # where to get val and test data from
        val:
            batch_size: 20
            val_data: null # Assigned to null because dataset is being instantiated
        test:
            batch_size: 20
            test_data: null # Assigned to null because dataset is being instantiated
    type: model_optimization
    aggregate_median: softmax # how aggregations weights are computed
    initial_lr_client: 0.1 # learning rate used on client optimizer
    lr_decay_factor: 1.0
    weight_train_loss: train_loss
    best_model_criterion: loss
    fall_back_to_best_model: false
    fast_aggregation: true
    softmax_beta: 1.0

# Dictates the learning parameters for client-side model updates. Train data is defined inside this config.
client_config:
    do_profiling: false # run profiling and compute runtime metrics
    ignore_subtask: false
    data_config: # where to get training data from
        train:
            batch_size: 20
            # list_of_train_data: "client_data_mapping/train.csv"
            list_of_train_data: "json" # Assigned to null because dataset is being instantiated
            desired_max_samples: 500000
            data_loc: "/datasets/FedScale/openImg/train"
            filter_less: 21
            filter_more: 1000000000
    optimizer_config: # this is the optimizer used by the client
        type: sgd
        lr: 0.05 # this is overridden by `initial_lr_client`
        momentum: 0.90
        weight_decay: 0.0005
    type: optimization
